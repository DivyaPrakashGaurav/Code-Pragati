<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="shortcut icon" href="SIH Logo.png" type="image/x-icon">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Code Pragati Diary System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9;
        }

        .sidebar {
            transition: transform 0.3s ease-in-out;
        }

        .main-content {
            transition: margin-left 0.3s ease-in-out;
        }

        .sidebar-open {
            transform: translateX(0);
        }

        .sidebar-closed {
            transform: translateX(-100%);
        }

        @media (min-width: 768px) {
            .sidebar-closed {
                transform: translateX(0);
            }
        }

        .bilingual-label span {
            display: block;
        }

        .bilingual-label .secondary-lang {
            font-size: 0.9em;
            color: #64748b;
        }

        .mic-btn {
            cursor: pointer;
            color: #64748b;
            transition: color 0.2s;
        }

        .mic-btn:hover {
            color: #4338ca;
        }

        .mic-btn.listening {
            color: #dc2626;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }

            100% {
                transform: scale(1);
            }
        }

        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.5);
        }

        .form-section {
            border-left: 4px solid #6366f1;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            border-radius: 0.5rem;
            transition: all 0.2s;
            font-weight: 500;
            color: #334155;
        }

        .nav-link:hover {
            background-color: #f1f5f9;
            color: #1e293b;
        }

        .nav-link.active {
            background-color: #eef2ff;
            color: #4338ca;
            font-weight: 600;
            border-left: 3px solid #4f46e5;
            padding-left: calc(1rem - 3px);
        }

        .nav-link svg {
            margin-right: 0.75rem;
            width: 1.25rem;
            height: 1.25rem;
        }

        .lang-select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path stroke="%236b7280" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 8l4 4 4-4"/></svg>');
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
        }

        .styled-table tbody tr:nth-child(even) {
            background-color: #f8fafc;
        }
    </style>
</head>

<body class="text-slate-800">

    <div class="flex h-screen">
        <aside id="sidebar"
            class="sidebar sidebar-closed md:sidebar-open fixed md:relative z-20 bg-white w-72 h-full shadow-lg p-4 flex flex-col border-r border-slate-200">

            <!-- Sidebar Header with Logo -->
            <div class="flex items-center gap-3 mb-2 px-2">
                <!-- Logo Image -->
                <img src="SIH Logo.png" alt="Logo" class="w-10 h-10 object-contain">

                <h1 class="text-xl font-bold text-slate-800">Code Pragati</h1>
            </div>

            <p class="text-sm text-slate-500 mb-6 ml-2" id="sidebar-subtitle">Diary System</p>
            <nav class="flex-grow">
                <ul>
                    <li><a href="#" class="nav-link active" data-form="deniedBeneficiaries"><svg xmlns="" fill="none"
                                viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" />
                            </svg><span class="bilingual-label"><span>Denied Beneficiaries</span><span
                                    class="secondary-lang" data-translate-key="deniedBeneficiaries_nav">प्रत्याख्यापित
                                    लाभार्थी</span></span></a></li>
                    <li><a href="#" class="nav-link" data-form="guestsOutside"><svg xmlns="http://www.w3.org/2000/svg"
                                fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3" />
                            </svg><span class="bilingual-label"><span>Guests Outside</span><span class="secondary-lang"
                                    data-translate-key="guestsOutside_nav">बाहर गए अतिथि</span></span></a></li>
                    <li><a href="#" class="nav-link" data-form="pregnantWoman"><svg xmlns="http://www.w3.org/2000/svg"
                                fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
                            </svg><span class="bilingual-label"><span>Pregnant Woman</span><span class="secondary-lang"
                                    data-translate-key="pregnantWoman_nav">गर्भवती महिला</span></span></a></li>
                </ul>
            </nav>
            <div class="mt-auto space-y-2">
                <label id="ocr-scan-btn"
                    class="cursor-pointer nav-link bg-slate-100 hover:bg-slate-200 w-full text-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.776 48.776 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z" />
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z" />
                    </svg>
                    <a href="/OCR.html"><span data-translate-key="ocrScan">OCR Scan</span></a>
                </label>
                <div class="text-center text-xs text-slate-400 pt-4">
                    <p>&copy; 2025 Code Pragati</p>
                </div>
            </div>
        </aside>

        <main id="main-content" class="main-content flex-1 h-full overflow-y-auto p-6 md:p-8">
            <header class="flex justify-between items-center mb-6">
                <div class="flex items-center gap-4">
                    <button id="menu-toggle" class="p-2 md:hidden text-slate-600 hover:text-indigo-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                            xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 6h16M4 12h16m-7 6h7"></path>
                        </svg>
                    </button>
                    <h1 id="main-header" class="text-2xl font-bold text-slate-800">
                        <span id="main-header-en"></span>
                        <span id="main-header-secondary" class="text-xl font-medium text-slate-500"></span>
                    </h1>
                </div>
                <div class="flex items-center gap-4">
                    <label for="language-selector" class="text-sm font-medium text-slate-600 hidden sm:block"
                        data-translate-key="languageLabel">Language:</label>
                    <select id="language-selector"
                        class="lang-select bg-white border border-slate-300 rounded-md shadow-sm py-2 px-3 text-sm font-medium text-slate-700 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"></select>
                </div>
            </header>

            <div id="form-deniedBeneficiaries" class="form-container"></div>
            <div id="form-guestsOutside" class="form-container hidden"></div>
            <div id="form-pregnantWoman" class="form-container hidden"></div>
        </main>
    </div>

    <div id="editModal" class="fixed inset-0 z-30 hidden items-center justify-center modal-backdrop">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col">
            <div class="p-4 border-b flex justify-between items-center bg-slate-50 rounded-t-lg">
                <h2 class="text-xl font-bold text-gray-700" data-translate-key="editRecord">Edit Record</h2>
                <button id="closeEditModal"
                    class="text-gray-500 hover:text-gray-800 text-3xl font-light">&times;</button>
            </div>
            <div id="editModalBody" class="p-6 overflow-y-auto"></div>
        </div>
    </div>

    <script>
        // --- APP CONFIGURATION ---
        const formsConfig = {
            deniedBeneficiaries: {
                titleKey: "deniedBeneficiaries_title",
                fields: [
                    { id: 'serialNumber', type: 'text' }, { id: 'houseNumber', type: 'text' }, { id: 'applicantName', type: 'text' },
                    { id: 'gender', type: 'select', options: ['Male / पुरुष', 'Female / महिला', 'Other / अन्य'] },
                    { id: 'fatherHusbandName', type: 'text' }, { id: 'mobileNumber', type: 'tel' }, { id: 'dobAge', type: 'date' },
                    { id: 'reasonForRefusal', type: 'textarea' }, { id: 'beneficiaryType', type: 'text' }, { id: 'influentialPerson', type: 'text' },
                    { id: 'influentialPersonMobile', type: 'tel' },
                ],
            },
            guestsOutside: {
                titleKey: "guestsOutside_title",
                fields: [
                    { id: 'serialNumber', type: 'text' }, { id: 'houseNumber', type: 'text' }, { id: 'beneficiaryName', type: 'text' },
                    { id: 'gender', type: 'select', options: ['Male / पुरुष', 'Female / महिला', 'Other / अन्य'] },
                    { id: 'fatherHusbandName', type: 'text' }, { id: 'mobileNumber', type: 'tel' }, { id: 'dobAge', type: 'date' },
                    { id: 'monthOfGoingOut', type: 'month' }, { id: 'feelingOfComingBack', type: 'textarea' },
                ]
            },
            pregnantWoman: {
                titleKey: "pregnantWoman_title",
                fields: [
                    { type: 'section', titleKey: 'basicInfo_section', fields: [{ id: 'serialNumber', type: 'text' }, { id: 'pregnantWomanName', type: 'text' }, { id: 'husbandName', type: 'text' }, { id: 'mobileNumber', type: 'tel' }, { id: 'careTypeAndId', type: 'text' }, { id: 'lmpDate', type: 'date' }, { id: 'eddDate', type: 'date' },] },
                    { type: 'section', titleKey: 'vaccination_section', fields: [{ id: 'vaccinationDate', type: 'date' }, { id: 'td1', type: 'text' }, { id: 'td2', type: 'text' }, { id: 'tdBooster', type: 'text' },] },
                    { type: 'section', titleKey: 'prenatal1_section', fields: [{ id: 'check1Date', type: 'date' }, { id: 'check1Weight', type: 'text' }, { id: 'check1Bp', type: 'text' }, { id: 'check1Hb', type: 'text' }, { id: 'check1Folic', type: 'text' },] },
                    { type: 'section', titleKey: 'prenatal2_section', fields: [{ id: 'check2Date', type: 'date' }, { id: 'check2Weight', type: 'text' }, { id: 'check2Bp', type: 'text' }, { id: 'check2Calcium', type: 'text' }, { id: 'check2Iron', type: 'text' },] },
                    { type: 'section', titleKey: 'prenatal3_section', fields: [{ id: 'check3Date', type: 'date' }, { id: 'check3Weight', type: 'text' }, { id: 'check3Bp', type: 'text' },] },
                    { type: 'section', titleKey: 'prenatal4_section', fields: [{ id: 'check4Date', type: 'date' }, { id: 'check4Weight', type: 'text' }, { id: 'check4Bp', type: 'text' },] },
                ]
            }
        };
        const allLanguages = [{ code: 'en-IN', name: 'English' }, { code: 'hi-IN', name: 'हिन्दी' }, { code: 'gu-IN', name: 'ગુજરાતી' }, { code: 'kn-IN', name: 'ಕನ್ನಡ' }, { code: 'ml-IN', name: 'മലയാളം' }, { code: 'mr-IN', name: 'मराठी' }, { code: 'ta-IN', name: 'தமிழ்' },];

        // --- TRANSLATIONS ---
        const translations = {
            'en-IN': {
                diarySystem: "Diary System", importCSV: "Import CSV", ocrScan: "OCR Scan", editRecord: "Edit Record",
                addNewRecord: "Add New Record", saveRecord: "Save Record", searchPlaceholder: "Search records...", actions: "Actions",
                noRecords: "No records found.", cancel: "Cancel", saveChanges: "Save Changes", languageLabel: "Language:", savedRecords: "Saved Records",
                deniedBeneficiaries_nav: "Denied Beneficiaries", guestsOutside_nav: "Guests Outside", pregnantWoman_nav: "Pregnant Woman",
                deniedBeneficiaries_title: "Details of Denied Beneficiaries", guestsOutside_title: "Guests Gone Outside", pregnantWoman_title: "Details of Pregnant Woman",
                basicInfo_section: "Basic Information", vaccination_section: "Vaccination", prenatal1_section: "Prenatal Care - First Check", prenatal2_section: "Prenatal Care - Second Check", prenatal3_section: "Prenatal Care - Third Check", prenatal4_section: "Prenatal Care - Fourth Check",
                serialNumber: "Serial Number", houseNumber: "House Number", applicantName: "Applicant Name (Rejected)", gender: "Gender", fatherHusbandName: "Father / Husband Name", mobileNumber: "Mobile Number", dobAge: "Date of Birth / Age", reasonForRefusal: "Reason for Refusal", beneficiaryType: "Who is the Beneficiary?", influentialPerson: "Influential Person", influentialPersonMobile: "Influential Person Mobile",
                beneficiaryName: "Beneficiary Name", monthOfGoingOut: "Month of Going Out", feelingOfComingBack: "Feeling of Coming Back",
                pregnantWomanName: "Name of Pregnant Woman", husbandName: "Name of the Husband", careTypeAndId: "Care Type & ID", lmpDate: "Last Menstrual Period Date", eddDate: "Expected Delivery Date",
                vaccinationDate: "Vaccination Date", td1: "T.D.1", td2: "T.D.2", tdBooster: "T.D. Booster",
                check1Date: "Investigation Date", check1Weight: "Weight", check1Bp: "B.P.", check1Hb: "Hemoglobin", check1Folic: "Folic Acid Tablets",
                check2Date: "Visit Date", check2Weight: "Weight", check2Bp: "B.P.", check2Calcium: "360 Calcium Tablets", check2Iron: "180 Iron-Folic Tablets",
                check3Date: "Visit Date", check3Weight: "Weight", check3Bp: "B.P.", check4Date: "Visit Date", check4Weight: "Weight", check4Bp: "B.P.",
            },
            'hi-IN': {
                diarySystem: "डायरी प्रणाली", importCSV: "सीएसवी आयात करें", ocrScan: "ओसीआर स्कैन", editRecord: "रिकॉर्ड संपादित करें",
                addNewRecord: "नया रिकॉर्ड जोड़ें", saveRecord: "रिकॉर्ड सहेजें", searchPlaceholder: "रिकॉर्ड खोजें...", actions: "क्रियाएँ",
                noRecords: "कोई रिकॉर्ड नहीं मिला।", cancel: "रद्द करें", saveChanges: "बदलाव सहेजें", languageLabel: "भाषा:", savedRecords: "सहेजे गए रिकॉर्ड्स",
                deniedBeneficiaries_nav: "प्रत्याख्यापित लाभार्थी", guestsOutside_nav: "बाहर गए अतिथि", pregnantWoman_nav: "गर्भवती महिला",
                deniedBeneficiaries_title: "प्रत्याख्यापित लाभार्थियों का विवरण", guestsOutside_title: "बाहर गए अतिथियों का विवरण", pregnantWoman_title: "गर्भवती महिला का विवरण",
                basicInfo_section: "मूल जानकारी", vaccination_section: "टीकाकरण", prenatal1_section: "पूर्व प्रसव देखभाल - प्रथम जांच", prenatal2_section: "पूर्व प्रसव देखभाल - द्वितीय जांच", prenatal3_section: "पूर्व प्रसव देखभाल - तृतीय जांच", prenatal4_section: "पूर्व प्रसव देखभाल - चतुर्थ जांच",
                serialNumber: "क्रमांक", houseNumber: "घर का नंबर", applicantName: "आवेदक का नाम (अस्वीकृत)", gender: "लिंग", fatherHusbandName: "पिता / पति का नाम", mobileNumber: "मोबाइल नंबर", dobAge: "जन्म तिथि / आयु", reasonForRefusal: "अस्वीकृति का कारण", beneficiaryType: "लाभार्थी कौन है?", influentialPerson: "प्रभावशाली व्यक्ति", influentialPersonMobile: "प्रभावशाली व्यक्ति मोबाइल",
                beneficiaryName: "लाभार्थी का नाम", monthOfGoingOut: "बाहर जाने का महीना", feelingOfComingBack: "वापस आने की भावना",
                pregnantWomanName: "गर्भवती महिला का नाम", husbandName: "पति का नाम", careTypeAndId: "देखभाल का प्रकार और पहचान", lmpDate: "अंतिम मासिक धर्म की तिथि", eddDate: "प्रसव की संभावित तिथि",
                vaccinationDate: "टीकाकरण की तिथि", td1: "टी.डी.1", td2: "टी.डी.2", tdBooster: "टी.डी. बूस्टर",
                check1Date: "जांच की तिथि", check1Weight: "वज़न", check1Bp: "रक्तचाप", check1Hb: "हीमोग्लोबिन", check1Folic: "फोलिक एसिड की गोलियां",
                check2Date: "भ्रमण की तिथि", check2Weight: "वज़न", check2Bp: "रक्तचाप", check2Calcium: "360 कैल्शियम की गोलियां", check2Iron: "180 आयरन-फोलिक गोलियां",
                check3Date: "भ्रमण की तिथि", check3Weight: "वज़न", check3Bp: "रक्तचाप", check4Date: "भ्रमण की तिथि", check4Weight: "वज़न", check4Bp: "रक्तचाप",
            },
            'mr-IN': {
                diarySystem: "डायरी प्रणाली", importCSV: "CSV आयात करा", ocrScan: "OCR स्कॅन", editRecord: "रेकॉर्ड संपादित करा",
                addNewRecord: "नवीन रेकॉर्ड जोडा", saveRecord: "रेकॉर्ड जतन करा", searchPlaceholder: "शोधा...", actions: "क्रिया",
                noRecords: "एकही रेकॉर्ड आढळला नाही.", cancel: "रद्द करा", saveChanges: "बदल जतन करा", languageLabel: "भाषा:", savedRecords: "जतन केलेले रेकॉर्ड",
                deniedBeneficiaries_nav: "नाकारलेले लाभार्थी", guestsOutside_nav: "बाहेर गेलेले पाहुणे", pregnantWoman_nav: "गर्भवती महिला",
                deniedBeneficiaries_title: "नाकारलेल्या लाभार्थ्यांचा तपशील", guestsOutside_title: "बाहेर गेलेल्या पाहुण्यांचा तपशील", pregnantWoman_title: "गर्भवती महिलेचा तपशील",
                serialNumber: "अनुक्रमांक", houseNumber: "घर क्रमांक", applicantName: "अर्जदाराचे नाव (नाकारलेले)", gender: "लिंग", fatherHusbandName: "वडिलांचे/पतीचे नाव", mobileNumber: "मोबाइल नंबर", dobAge: "जन्मतारीख / वय", reasonForRefusal: "नाकारण्याचे कारण",
            },
            'ta-IN': {
                diarySystem: "டைரி அமைப்பு", importCSV: "CSV இறக்குமதி", ocrScan: "OCR ஸ்கேன்", editRecord: "பதிவைத் திருத்து",
                addNewRecord: "புதிய பதிவைச் சேர்", saveRecord: "பதிவைச் சேமி", searchPlaceholder: "தேடு...", actions: "செயல்கள்",
                noRecords: "பதிவுகள் எதுவும் இல்லை.", cancel: "ரத்துசெய்", saveChanges: "மாற்றங்களைச் சேமி", languageLabel: "மொழி:", savedRecords: "சேமித்த பதிவுகள்",
                deniedBeneficiaries_nav: "நிராகரிக்கப்பட்ட பயனாளிகள்", guestsOutside_nav: "வெளியே சென்ற விருந்தினர்கள்", pregnantWoman_nav: "கர்ப்பிணிப் பெண்",
                deniedBeneficiaries_title: "நிராகரிக்கப்பட்ட பயனாளிகளின் விவரங்கள்", guestsOutside_title: "வெளியே சென்ற விருந்தினர்களின் விவரங்கள்", pregnantWoman_title: "கர்ப்பிணிப் பெண்ணின் விவரங்கள்",
                serialNumber: "வரிசை எண்", houseNumber: "வீட்டு எண்", applicantName: "விண்ணப்பதாரர் பெயர் (நிராகரிக்கப்பட்டது)", gender: "பாலினம்", fatherHusbandName: "தந்தை / கணவர் பெயர்", mobileNumber: "கைபேசி எண்", dobAge: "பிறந்த தேதி / வயது", reasonForRefusal: "நிராகரிப்புக்கான காரணம்",
            },
            'gu-IN': {
                diarySystem: "ડાયરી સિસ્ટમ", importCSV: "CSV આયાત કરો", ocrScan: "OCR સ્કેન", editRecord: "રેકોર્ડ સંપાદિત કરો",
                addNewRecord: "નવો રેકોર્ડ ઉમેરો", saveRecord: "રેકોર્ડ સાચવો", searchPlaceholder: "રેકોર્ડ શોધો...", actions: "ક્રિયાઓ",
                noRecords: "કોઈ રેકોર્ડ મળ્યો નથી.", cancel: "રદ કરો", saveChanges: "ફેરફારો સાચવો", languageLabel: "ભાષા:", savedRecords: "સાચવેલા રેકોર્ડ",
                deniedBeneficiaries_nav: "વંચિત લાભાર્થીઓ", guestsOutside_nav: "બહાર ગયેલા મહેમાનો", pregnantWoman_nav: "ગર્ભવતી સ્ત્રી",
                deniedBeneficiaries_title: "વંચિત લાભાર્થીઓની વિગતો", guestsOutside_title: "બહાર ગયેલા મહેમાનોની વિગતો", pregnantWoman_title: "ગર્ભવતી સ્ત્રીની વિગતો",
                basicInfo_section: "મૂળભૂત માહિતી", vaccination_section: "રસીકરણ", prenatal1_section: "પ્રસવપૂર્વ કાળજી - પ્રથમ તપાસ", prenatal2_section: "પ્રસવપૂર્વ કાળજી - બીજી તપાસ", prenatal3_section: "પ્રસવપૂર્વ કાળજી - ત્રીજી તપાસ", prenatal4_section: "પ્રસવપૂર્વ કાળજી - ચોથી તપાસ",
                serialNumber: "ક્રમ નંબર", houseNumber: "મકાન નંબર", applicantName: "અરજદારનું નામ (નકારવામાં આવ્યું)", gender: "લિંગ", fatherHusbandName: "પિતા / પતિનું નામ", mobileNumber: "મોબાઇલ નંબર", dobAge: "જન્મતારીખ / ઉંમર", reasonForRefusal: "નકારી દેવાનો કારણ", beneficiaryType: "લાભાર્થી કોણ છે?", influentialPerson: "પ્રભાવશાળી વ્યક્તિ", influentialPersonMobile: "પ્રભાવશાળી વ્યક્તિનો મોબાઇલ",
                beneficiaryName: "લાભાર્થીનું નામ", monthOfGoingOut: "બહાર જવાનો મહિનો", feelingOfComingBack: "પાછા આવવાની લાગણી",
                pregnantWomanName: "ગર્ભવતી સ્ત્રીનું નામ", husbandName: "પતિનું નામ", careTypeAndId: "કાળજીનો પ્રકાર અને આઈડી", lmpDate: "છેલ્લી માસિકની તારીખ", eddDate: "અપેક્ષિત પ્રસવ તારીખ",
                vaccinationDate: "રસીકરણની તારીખ", td1: "ટી.ડી.1", td2: "ટી.ડી.2", tdBooster: "ટી.ડી. બૂસ્ટર",
                check1Date: "તપાસ તારીખ", check1Weight: "વજન", check1Bp: "બ્લડ પ્રેશર", check1Hb: "હીમોગ્લોબિન", check1Folic: "ફોલિક એસિડ ગોળીઓ",
                check2Date: "ભેટ તારીખ", check2Weight: "વજન", check2Bp: "બ્લડ પ્રેશર", check2Calcium: "૩૬૦ કેલ્શિયમ ગોળીઓ", check2Iron: "૧૮૦ આયર્ન-ફોલિક ગોળીઓ",
                check3Date: "ભેટ તારીખ", check3Weight: "વજન", check3Bp: "બ્લડ પ્રેશર", check4Date: "ભેટ તારીખ", check4Weight: "વજન", check4Bp: "બ્લડ પ્રેશર",
            },
            'kn-IN': {
                diarySystem: "ಡೈರಿ ವ್ಯವಸ್ಥೆ", importCSV: "CSV ಆಮದುಮಾಡಿ", ocrScan: "OCR ಸ್ಕ್ಯಾನ್", editRecord: "ರೆಕಾರ್ಡ್ ಸಂಪಾದಿಸಿ",
                addNewRecord: "ಹೊಸ ರೆಕಾರ್ಡ್ ಸೇರಿಸಿ", saveRecord: "ರೆಕಾರ್ಡ್ ಉಳಿಸಿ", searchPlaceholder: "ರೆಕಾರ್ಡ್ ಹುಡುಕಿ...", actions: "ಕ್ರಿಯೆಗಳು",
                noRecords: "ಯಾವುದೇ ದಾಖಲೆ ಕಂಡುಬಂದಿಲ್ಲ.", cancel: "ರದ್ದುಮಾಡಿ", saveChanges: "ಬದಲಾವಣೆಗಳನ್ನು ಉಳಿಸಿ", languageLabel: "ಭಾಷೆ:", savedRecords: "ಉಳಿಸಿದ ದಾಖಲೆಗಳು",
                deniedBeneficiaries_nav: "ನಿರಾಕರಿಸಿದ ಫಲಾನುಭವಿಗಳು", guestsOutside_nav: "ಹೊರಗೆ ಹೋದ ಅತಿಥಿಗಳು", pregnantWoman_nav: "ಗರ್ಭಿಣಿ ಮಹಿಳೆ",
                deniedBeneficiaries_title: "ನಿರಾಕರಿಸಿದ ಫಲಾನುಭವಿಗಳ ವಿವರಗಳು", guestsOutside_title: "ಹೊರಗೆ ಹೋದ ಅತಿಥಿಗಳ ವಿವರಗಳು", pregnantWoman_title: "ಗರ್ಭಿಣಿ ಮಹಿಳೆಯ ವಿವರಗಳು",
                basicInfo_section: "ಮೂಲಭೂತ ಮಾಹಿತಿ", vaccination_section: "ಲಸಿಕೆ", prenatal1_section: "ಗರ್ಭಪೂರ್ವ ಆರೈಕೆ - ಮೊದಲ ಪರಿಶೀಲನೆ", prenatal2_section: "ಗರ್ಭಪೂರ್ವ ಆರೈಕೆ - ಎರಡನೇ ಪರಿಶೀಲನೆ", prenatal3_section: "ಗರ್ಭಪೂರ್ವ ಆರೈಕೆ - ಮೂರನೇ ಪರಿಶೀಲನೆ", prenatal4_section: "ಗರ್ಭಪೂರ್ವ ಆರೈಕೆ - ನಾಲ್ಕನೇ ಪರಿಶೀಲನೆ",
                serialNumber: "ಅನುಕ್ರಮ ಸಂಖ್ಯೆ", houseNumber: "ಮನೆ ಸಂಖ್ಯೆ", applicantName: "ಅರ್ಜಿದಾರರ ಹೆಸರು (ನಿರಾಕರಿಸಲಾಗಿದೆ)", gender: "ಲಿಂಗ", fatherHusbandName: "ತಂದೆ / ಗಂಡನ ಹೆಸರು", mobileNumber: "ಮೊಬೈಲ್ ಸಂಖ್ಯೆ", dobAge: "ಜನ್ಮ ದಿನಾಂಕ / ವಯಸ್ಸು", reasonForRefusal: "ನಿರಾಕರಣೆಯ ಕಾರಣ", beneficiaryType: "ಫಲಾನುಭವಿಯಾರು?", influentialPerson: "ಪ್ರಭಾವಿ ವ್ಯಕ್ತಿ", influentialPersonMobile: "ಪ್ರಭಾವಿ ವ್ಯಕ್ತಿಯ ಮೊಬೈಲ್",
                beneficiaryName: "ಫಲಾನುಭವಿಯ ಹೆಸರು", monthOfGoingOut: "ಹೊರಗೆ ಹೋದ ತಿಂಗಳು", feelingOfComingBack: "ಮತ್ತೆ ಬರುವ ಭಾವನೆ",
                pregnantWomanName: "ಗರ್ಭಿಣಿ ಮಹಿಳೆಯ ಹೆಸರು", husbandName: "ಗಂಡನ ಹೆಸರು", careTypeAndId: "ಆರೈಕೆ ಪ್ರಕಾರ ಮತ್ತು ಐಡಿ", lmpDate: "ಕೊನೆಯ ಮಾಸಿಕದ ದಿನಾಂಕ", eddDate: "ನಿರೀಕ್ಷಿತ ವಿತರಣಾ ದಿನಾಂಕ",
                vaccinationDate: "ಲಸಿಕೆ ದಿನಾಂಕ", td1: "ಟಿ.ಡಿ.1", td2: "ಟಿ.ಡಿ.2", tdBooster: "ಟಿ.ಡಿ. ಬೂಸ್ಟರ್",
                check1Date: "ಪರಿಶೀಲನೆ ದಿನಾಂಕ", check1Weight: "ತೂಕ", check1Bp: "ರಕ್ತದ ಒತ್ತಡ", check1Hb: "ಹೆಮೋಗ್ಲೋಬಿನ್", check1Folic: "ಫೋಲಿಕ್ ಆಮ್ಲದ ಮಾತ್ರೆಗಳು",
                check2Date: "ಭೇಟಿ ದಿನಾಂಕ", check2Weight: "ತೂಕ", check2Bp: "ರಕ್ತದ ಒತ್ತಡ", check2Calcium: "೩೬೦ ಕ್ಯಾಲ್ಸಿಯಂ ಮಾತ್ರೆಗಳು", check2Iron: "೧೮೦ ಐರನ್-ಫೋಲಿಕ್ ಮಾತ್ರೆಗಳು",
                check3Date: "ಭೇಟಿ ದಿನಾಂಕ", check3Weight: "ತೂಕ", check3Bp: "ರಕ್ತದ ಒತ್ತಡ", check4Date: "ಭೇಟಿ ದಿನಾಂಕ", check4Weight: "ತೂಕ", check4Bp: "ರಕ್ತದ ಒತ್ತಡ",
            },
            'ml-IN': {
                diarySystem: "ഡയറി സിസ്റ്റം", importCSV: "CSV ഇറക്കുമതി ചെയ്യുക", ocrScan: "OCR സ്കാൻ", editRecord: "റെക്കോർഡ് തിരുത്തുക",
                addNewRecord: "പുതിയ റെക്കോർഡ് ചേർക്കുക", saveRecord: "റെക്കോർഡ് സംരക്ഷിക്കുക", searchPlaceholder: "റെക്കോർഡുകൾ തിരയുക...", actions: "നടപടികൾ",
                noRecords: "റെക്കോർഡുകൾ ഒന്നും കണ്ടെത്തിയില്ല.", cancel: "റദ്ദാക്കുക", saveChanges: "മാറ്റങ്ങൾ സംരക്ഷിക്കുക", languageLabel: "ഭാഷ:", savedRecords: "സംരക്ഷിച്ച റെക്കോർഡുകൾ",
                deniedBeneficiaries_nav: "നിഷേധിച്ച ആനുകൂല്യക്കാർ", guestsOutside_nav: "പുറത്തുപോയ അതിഥികൾ", pregnantWoman_nav: "ഗർഭിണി",
                deniedBeneficiaries_title: "നിഷേധിച്ച ആനുകൂല്യക്കാരുടെ വിശദാംശങ്ങൾ", guestsOutside_title: "പുറത്തുപോയ അതിഥികളുടെ വിശദാംശങ്ങൾ", pregnantWoman_title: "ഗർഭിണിയുടെ വിശദാംശങ്ങൾ",
                basicInfo_section: "അടിസ്ഥാന വിവരം", vaccination_section: "പ്രതിരോധ കുത്തിവെപ്പ്", prenatal1_section: "ഗർഭകാല പരിചരണം - ആദ്യ പരിശോധന", prenatal2_section: "ഗർഭകാല പരിചരണം - രണ്ടാം പരിശോധന", prenatal3_section: "ഗർഭകാല പരിചരണം - മൂന്നാം പരിശോധന", prenatal4_section: "ഗർഭകാല പരിചരണം - നാലാം പരിശോധന",
                serialNumber: "ക്രമ സംഖ്യ", houseNumber: "വീട് നമ്പർ", applicantName: "അപേക്ഷകന്റെ പേര് (നിഷേധിച്ചു)", gender: "ലിംഗം", fatherHusbandName: "പിതാവ് / ഭർത്താവിന്റെ പേര്", mobileNumber: "മൊബൈൽ നമ്പർ", dobAge: "ജനനത്തീയതി / വയസ്സ്", reasonForRefusal: "നിഷേധത്തിനുള്ള കാരണം", beneficiaryType: "ആനുകൂല്യക്കാരൻ ആര്?", influentialPerson: "പ്രഭാവമുള്ള വ്യക്തി", influentialPersonMobile: "പ്രഭാവമുള്ള വ്യക്തിയുടെ മൊബൈൽ",
                beneficiaryName: "ആനുകൂല്യക്കാരന്റെ പേര്", monthOfGoingOut: "പുറത്തുപോയ മാസം", feelingOfComingBack: "തിരികെ വരുന്ന അനുഭവം",
                pregnantWomanName: "ഗർഭിണിയുടെ പേര്", husbandName: "ഭർത്താവിന്റെ പേര്", careTypeAndId: "പരിചരണ തരം & ഐഡി", lmpDate: "അവസാന മാസവാരിയുടെ തീയതി", eddDate: "പ്രതീക്ഷിക്കുന്ന പ്രസവ തീയതി",
                vaccinationDate: "പ്രതിരോധ കുത്തിവെപ്പ് തീയതി", td1: "ടി.ഡി.1", td2: "ടി.ഡി.2", tdBooster: "ടി.ഡി. ബൂസ്റ്റർ",
                check1Date: "പരിശോധന തീയതി", check1Weight: "ഭാരം", check1Bp: "ബ്ലഡ് പ്രഷർ", check1Hb: "ഹീമോഗ്ലോബിൻ", check1Folic: "ഫോളിക് ആസിഡ് ഗുളികകൾ",
                check2Date: "സന്ദർശന തീയതി", check2Weight: "ഭാരം", check2Bp: "ബ്ലഡ് പ്രഷർ", check2Calcium: "360 കാല്ഷ്യം ഗുളികകൾ", check2Iron: "180 അയൺ-ഫോളിക് ഗുളികകൾ",
                check3Date: "സന്ദർശന തീയതി", check3Weight: "ഭാരം", check3Bp: "ബ്ലഡ് പ്രഷർ", check4Date: "സന്ദർശന തീയതി", check4Weight: "ഭാരം", check4Bp: "ബ്ലഡ് പ്രഷർ",
            },
            'mr-IN': {
                diarySystem: "डायरी प्रणाली", importCSV: "CSV आयात करा", ocrScan: "OCR स्कॅन", editRecord: "रेकॉर्ड संपादित करा",
                addNewRecord: "नवीन रेकॉर्ड जोडा", saveRecord: "रेकॉर्ड जतन करा", searchPlaceholder: "रेकॉर्ड शोधा...", actions: "क्रिया",
                noRecords: "कोणतेही रेकॉर्ड सापडले नाहीत.", cancel: "रद्द करा", saveChanges: "बदल जतन करा", languageLabel: "भाषा:", savedRecords: "जतन केलेले रेकॉर्ड",
                deniedBeneficiaries_nav: "नाकारलेले लाभार्थी", guestsOutside_nav: "बाहेर गेलेले पाहुणे", pregnantWoman_nav: "गर्भवती महिला",
                deniedBeneficiaries_title: "नाकारलेल्या लाभार्थ्यांचा तपशील", guestsOutside_title: "बाहेर गेलेल्या पाहुण्यांचा तपशील", pregnantWoman_title: "गर्भवती महिलेचा तपशील",
                basicInfo_section: "मूलभूत माहिती", vaccination_section: "लसीकरण", prenatal1_section: "प्रसवपूर्व काळजी - पहिली तपासणी", prenatal2_section: "प्रसवपूर्व काळजी - दुसरी तपासणी", prenatal3_section: "प्रसवपूर्व काळजी - तिसरी तपासणी", prenatal4_section: "प्रसवपूर्व काळजी - चौथी तपासणी",
                serialNumber: "क्रमांक", houseNumber: "घर क्रमांक", applicantName: "अर्जदाराचे नाव (नाकारलेले)", gender: "लिंग", fatherHusbandName: "वडील / पतीचे नाव", mobileNumber: "मोबाईल क्रमांक", dobAge: "जन्मतारीख / वय", reasonForRefusal: "नकाराचे कारण", beneficiaryType: "लाभार्थी कोण?", influentialPerson: "प्रभावशाली व्यक्ती", influentialPersonMobile: "प्रभावशाली व्यक्तीचा मोबाईल",
                beneficiaryName: "लाभार्थ्याचे नाव", monthOfGoingOut: "बाहेर जाण्याचा महिना", feelingOfComingBack: "परत येण्याची भावना",
                pregnantWomanName: "गर्भवती महिलेचे नाव", husbandName: "पतीचे नाव", careTypeAndId: "काळजी प्रकार व आयडी", lmpDate: "शेवटच्या पाळीची तारीख", eddDate: "अपेक्षित प्रसूती तारीख",
                vaccinationDate: "लसीकरणाची तारीख", td1: "टी.डी.1", td2: "टी.डी.2", tdBooster: "टी.डी. बूस्टर",
                check1Date: "तपासणी तारीख", check1Weight: "वजन", check1Bp: "रक्तदाब", check1Hb: "हीमोग्लोबिन", check1Folic: "फॉलिक अॅसिड गोळ्या",
                check2Date: "भेट तारीख", check2Weight: "वजन", check2Bp: "रक्तदाब", check2Calcium: "360 कॅल्शियम गोळ्या", check2Iron: "180 आयर्न-फॉलिक गोळ्या",
                check3Date: "भेट तारीख", check3Weight: "वजन", check3Bp: "रक्तदाब", check4Date: "भेट तारीख", check4Weight: "वजन", check4Bp: "रक्तदाब",
            },
            'ta-IN': {
                diarySystem: "டையரி அமைப்பு", importCSV: "CSV இறக்குமதி", ocrScan: "OCR ஸ்கேன்", editRecord: "பதிவை திருத்தவும்",
                addNewRecord: "புதிய பதிவு சேர்க்கவும்", saveRecord: "பதிவை சேமிக்கவும்", searchPlaceholder: "பதிவுகளைத் தேடவும்...", actions: "செயல்கள்",
                noRecords: "பதிவுகள் எதுவும் கிடைக்கவில்லை.", cancel: "ரத்து செய்", saveChanges: "மாற்றங்களை சேமிக்கவும்", languageLabel: "மொழி:", savedRecords: "சேமிக்கப்பட்ட பதிவுகள்",
                deniedBeneficiaries_nav: "நிராகரிக்கப்பட்ட பயனாளிகள்", guestsOutside_nav: "வெளியே சென்ற விருந்தினர்கள்", pregnantWoman_nav: "கர்ப்பிணி பெண்",
                deniedBeneficiaries_title: "நிராகரிக்கப்பட்ட பயனாளிகளின் விவரங்கள்", guestsOutside_title: "வெளியே சென்ற விருந்தினர்களின் விவரங்கள்", pregnantWoman_title: "கர்ப்பிணி பெண்ணின் விவரங்கள்",
                basicInfo_section: "அடிப்படை தகவல்", vaccination_section: "தடுப்பூசி", prenatal1_section: "கர்ப்ப கால பராமரிப்பு - முதல் சோதனை", prenatal2_section: "கர்ப்ப கால பராமரிப்பு - இரண்டாவது சோதனை", prenatal3_section: "கர்ப்ப கால பராமரிப்பு - மூன்றாவது சோதனை", prenatal4_section: "கர்ப்ப கால பராமரிப்பு - நான்காவது சோதனை",
                serialNumber: "வரிசை எண்", houseNumber: "வீட்டு எண்", applicantName: "விண்ணப்பதாரர் பெயர் (நிராகரிக்கப்பட்டது)", gender: "பாலினம்", fatherHusbandName: "தந்தை / கணவர் பெயர்", mobileNumber: "மொபைல் எண்", dobAge: "பிறந்த தேதி / வயது", reasonForRefusal: "நிராகரிப்பின் காரணம்", beneficiaryType: "பயனாளர் யார்?", influentialPerson: "செல்வாக்கு கொண்டவர்", influentialPersonMobile: "செல்வாக்கு கொண்டவரின் மொபைல்",
                beneficiaryName: "பயனாளரின் பெயர்", monthOfGoingOut: "வெளியே சென்ற மாதம்", feelingOfComingBack: "திரும்பி வந்த உணர்வு",
                pregnantWomanName: "கர்ப்பிணி பெண்ணின் பெயர்", husbandName: "கணவர் பெயர்", careTypeAndId: "பராமரிப்பு வகை மற்றும் ஐடி", lmpDate: "கடைசி மாதவிடாய் தேதி", eddDate: "எதிர்பார்க்கப்படும் பிரசவ தேதி",
                vaccinationDate: "தடுப்பூசி தேதி", td1: "டி.டி.1", td2: "டி.டி.2", tdBooster: "டி.டி. பூஸ்டர்",
                check1Date: "சோதனை தேதி", check1Weight: "எடை", check1Bp: "இரத்த அழுத்தம்", check1Hb: "ஹீமோகுளோபின்", check1Folic: "ஃபோலிக் அமில மாத்திரைகள்",
                check2Date: "வருகை தேதி", check2Weight: "எடை", check2Bp: "இரத்த அழுத்தம்", check2Calcium: "360 கால்சியம் மாத்திரைகள்", check2Iron: "180 இரும்பு-ஃபோலிக் மாத்திரைகள்",
            },
        };

        // --- STATE MANAGEMENT ---
        let appState = { currentForm: 'deniedBeneficiaries', data: {}, filterText: '', recognition: null, activeInput: null, currentLanguage: 'en-IN' };

        // --- DOM ELEMENTS ---
        const sidebar = document.getElementById('sidebar');
        const menuToggle = document.getElementById('menu-toggle');
        const editModal = document.getElementById('editModal');

        // --- UTILITY & TRANSLATION ---
        const translate = (key) => {
            const lang = appState.currentLanguage;
            if (translations[lang] && translations[lang][key]) {
                return translations[lang][key];
            }
            return translations['en-IN'][key] || key;
        };

        function updateMainHeader() {
            const navLink = document.querySelector(`.nav-link[data-form="${appState.currentForm}"]`);
            if (navLink) {
                const englishText = navLink.querySelector('.bilingual-label span:first-child').textContent;
                const translationKey = navLink.querySelector('.secondary-lang').dataset.translateKey;

                document.getElementById('main-header-en').textContent = englishText;
                document.getElementById('main-header-secondary').textContent = ` / ${translate(translationKey)}`;
            }
        }

        const translateUI = () => {
            document.querySelectorAll('[data-translate-key]').forEach(el => {
                const key = el.dataset.translateKey;
                // For sidebar's secondary lang spans, which is the default behavior
                if (el.classList.contains('secondary-lang')) {
                    // The primary (English) part is static in the HTML
                    el.textContent = translate(key);
                } else {
                    // For all other elements, just set their content
                    el.textContent = translate(key);
                }
            });

            updateMainHeader();

            const searchInput = document.querySelector('.search-input');
            if (searchInput) searchInput.placeholder = translate('searchPlaceholder');
        };

        // --- SPEECH RECOGNITION (SIMPLIFIED) ---
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (SpeechRecognition) {
            appState.recognition = new SpeechRecognition();
            appState.recognition.continuous = false;
            appState.recognition.interimResults = false;

            appState.recognition.onresult = (event) => {
                if (appState.activeInput) {
                    appState.activeInput.value = event.results[0][0].transcript;
                }
                stopRecognition();
            };
            appState.recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                stopRecognition();
            };
            appState.recognition.onend = stopRecognition;
        }

        function startRecognition(inputElement, micButton) {
            if (!appState.recognition) {
                alert("Speech recognition is not supported in this browser.");
                return;
            }
            // If already listening, clicking again will stop it
            if (micButton.classList.contains('listening')) {
                stopRecognition();
                return;
            }

            appState.activeInput = inputElement;
            appState.recognition.lang = appState.currentLanguage; // Use the main UI language

            try {
                appState.recognition.start();
                micButton.classList.add('listening');
            } catch (e) {
                console.error("Speech recognition could not be started: ", e);
                stopRecognition();
            }
        }

        function stopRecognition() {
            if (appState.recognition) {
                appState.recognition.stop();
            }
            document.querySelectorAll('.mic-btn.listening').forEach(btn => btn.classList.remove('listening'));
            appState.activeInput = null;
        }

        // --- UI RENDERING ---
        function generateFormHTML(formId) {
            const config = formsConfig[formId];
            const formData = appState.data[formId] || [];

            let fieldsHTML = '';
            if (config.fields[0].type === 'section') {
                fieldsHTML = config.fields.map(section => `
                <div class="form-section bg-slate-50 p-4 rounded-md mb-6">
                    <h3 class="text-lg font-semibold text-indigo-700 mb-4">${translate(section.titleKey)}</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        ${section.fields.map(field => generateFieldHTML(field, formId)).join('')}
                    </div>
                </div>
            `).join('');
            } else {
                fieldsHTML = `<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                ${config.fields.map(field => generateFieldHTML(field, formId)).join('')}
            </div>`;
            }

            const tableHeaders = config.fields.flatMap(f => f.type === 'section' ? f.fields : [f]).map(field => `
            <th class="p-3 text-left text-xs font-bold text-slate-600 uppercase tracking-wider">${translate(field.id)}</th>
        `).join('') + `<th class="p-3 text-left text-xs font-bold text-slate-600 uppercase tracking-wider" data-translate-key="actions">${translate('actions')}</th>`;

            return `
        <div class="bg-white p-6 rounded-lg shadow-md mb-8">
            <h2 class="text-2xl font-bold text-slate-800 mb-4">${translate(config.titleKey)}</h2>
            <form id="${formId}-form" class="space-y-6">
                ${fieldsHTML}
                <div class="flex justify-end pt-4">
                    <button type="submit" class="bg-indigo-600 text-white font-bold py-2 px-6 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" data-translate-key="addNewRecord">
                        ${translate('addNewRecord')}
                    </button>
                </div>
            </form>
        </div>

        <div class="bg-white p-6 rounded-lg shadow-md">
            <div class="flex justify-between items-center mb-4">
                 <h3 class="text-xl font-bold text-slate-700" data-translate-key="savedRecords">${translate('savedRecords')}</h3>
                 <input type="text" class="search-input w-full max-w-xs border border-slate-300 rounded-md p-2 text-sm focus:ring-2 focus:ring-indigo-500" placeholder="${translate('searchPlaceholder')}" oninput="filterTable('${formId}', this.value)">
            </div>
            <div class="overflow-x-auto">
                <table class="styled-table min-w-full bg-white">
                    <thead class="bg-slate-100"><tr>${tableHeaders}</tr></thead>
                    <tbody id="${formId}-table-body">
                        ${formData.length > 0 ? formData.map((row, index) => generateTableRowHTML(row, formId, index)).join('') : `<tr><td colspan="${config.fields.flatMap(f => f.type === 'section' ? f.fields : [f]).length + 1}" class="p-4 text-center text-slate-500" data-translate-key="noRecords">${translate('noRecords')}</td></tr>`}
                    </tbody>
                </table>
            </div>
        </div>
        `;
        }

        function generateFieldHTML(field, formId) {
            const label = `<label for="${formId}-${field.id}" class="block text-sm font-medium text-slate-700 mb-1">${translate(field.id)}</label>`;
            const inputId = `${formId}-${field.id}`;
            const commonClasses = "w-full border-slate-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm";
            let input;

            switch (field.type) {
                case 'select':
                    input = `<select id="${inputId}" name="${field.id}" class="${commonClasses}">${field.options.map(o => `<option value="${o}">${o}</option>`).join('')}</select>`;
                    break;
                case 'textarea':
                    input = `<textarea id="${inputId}" name="${field.id}" rows="2" class="${commonClasses}"></textarea>`;
                    break;
                default:
                    input = `<input type="${field.type}" id="${inputId}" name="${field.id}" class="${commonClasses}">`;
            }

            return `<div class="relative">
            ${label}
            <div class="flex items-center">
                ${input}
                <button type="button" class="mic-btn ml-2 p-1" onclick="startRecognition(document.getElementById('${inputId}'), this)">
                     <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 14a2 2 0 1 0-4 0v-4a2 2 0 1 0 4 0v4ZM12 14a4 4 0 0 0 4-4V6a4 4 0 0 0-8 0v4a4 4 0 0 0 4 4Z" /><path d="M12 19a7 7 0 0 1-7-7v-2h2v2a5 5 0 0 0 10 0v-2h2v2a7 7 0 0 1-7 7Z" /></svg>
                </button>
            </div>
        </div>`;
        }

        function generateTableRowHTML(row, formId, index) {
            const config = formsConfig[formId];
            const fields = config.fields.flatMap(f => f.type === 'section' ? f.fields : [f]);
            const cells = fields.map(field => `<td class="p-3 text-sm text-slate-700 whitespace-nowrap">${row[field.id] || ''}</td>`).join('');
            return `<tr data-index="${index}">
            ${cells}
            <td class="p-3 text-sm">
                <div class="flex items-center gap-2">
                    <button onclick="showEditModal('${formId}', ${index})" class="text-indigo-600 hover:text-indigo-900 p-1">
                        <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" /></svg>
                    </button>
                    <button onclick="deleteData('${formId}', ${index})" class="text-red-600 hover:text-red-900 p-1">
                         <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.134-2.033-2.134H8.033c-1.12 0-2.033.954-2.033 2.134v.916m7.5 0a48.667 48.667 0 00-7.5 0" /></svg>
                    </button>
                </div>
            </td>
        </tr>`;
        }

        function renderForm(formId) {
            document.getElementById(`form-${formId}`).innerHTML = generateFormHTML(formId);
            document.getElementById(`${formId}-form`).addEventListener('submit', (e) => {
                e.preventDefault();
                saveData(formId);
            });
        }

        function loadData() {
            appState.data = JSON.parse(localStorage.getItem('diaryAppData')) || {};
        }

        function saveData(formId) {
            const form = document.getElementById(`${formId}-form`);
            const newRecord = {};
            const fields = formsConfig[formId].fields.flatMap(f => f.type === 'section' ? f.fields : [f]);
            fields.forEach(field => {
                newRecord[field.id] = form.elements[field.id].value;
            });

            if (!appState.data[formId]) appState.data[formId] = [];
            appState.data[formId].push(newRecord);
            localStorage.setItem('diaryAppData', JSON.stringify(appState.data));
            renderForm(formId);
            translateUI();
            form.reset();
        }

        function deleteData(formId, index) {
            if (confirm('Are you sure you want to delete this record?')) {
                appState.data[formId].splice(index, 1);
                localStorage.setItem('diaryAppData', JSON.stringify(appState.data));
                renderForm(formId);
                translateUI();
            }
        }

        function showEditModal(formId, index) {
            const record = appState.data[formId][index];
            const config = formsConfig[formId];
            const modalBody = document.getElementById('editModalBody');

            let modalFieldsHTML = '';
            if (config.fields[0].type === 'section') {
                modalFieldsHTML = config.fields.map(section => `
                <div class="form-section p-3 mb-4 border-l-4 border-indigo-200">
                    <h4 class="font-semibold text-gray-600 mb-2">${translate(section.titleKey)}</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        ${section.fields.map(field => generateModalFieldHTML(field, record)).join('')}
                    </div>
                </div>`).join('');
            } else {
                modalFieldsHTML = `<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                ${config.fields.map(field => generateModalFieldHTML(field, record)).join('')}
             </div>`;
            }

            modalBody.innerHTML = `
            <form id="edit-form">
                ${modalFieldsHTML}
                <div class="mt-6 flex justify-end gap-3">
                    <button type="button" id="cancelEdit" class="bg-slate-200 text-slate-800 font-bold py-2 px-4 rounded-md hover:bg-slate-300" data-translate-key="cancel">${translate('cancel')}</button>
                    <button type="submit" class="bg-indigo-600 text-white font-bold py-2 px-4 rounded-md hover:bg-indigo-700" data-translate-key="saveChanges">${translate('saveChanges')}</button>
                </div>
            </form>`;

            editModal.classList.remove('hidden');
            editModal.classList.add('flex');

            document.getElementById('edit-form').onsubmit = (e) => {
                e.preventDefault();
                updateData(formId, index);
            };
            document.getElementById('cancelEdit').onclick = () => editModal.classList.add('hidden');
            document.getElementById('closeEditModal').onclick = () => editModal.classList.add('hidden');
        }

        function generateModalFieldHTML(field, record) {
            const label = `<label for="edit-${field.id}" class="block text-sm font-medium text-slate-700">${translate(field.id)}</label>`;
            const value = record[field.id] || '';
            const commonClasses = "mt-1 block w-full border-slate-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm";

            switch (field.type) {
                case 'select':
                    return `<div>${label}<select id="edit-${field.id}" name="${field.id}" class="${commonClasses}">${field.options.map(o => `<option value="${o}" ${o === value ? 'selected' : ''}>${o}</option>`).join('')}</select></div>`;
                case 'textarea':
                    return `<div>${label}<textarea id="edit-${field.id}" name="${field.id}" rows="2" class="${commonClasses}">${value}</textarea></div>`;
                default:
                    return `<div>${label}<input type="${field.type}" id="edit-${field.id}" name="${field.id}" value="${value}" class="${commonClasses}"></div>`;
            }
        }

        function updateData(formId, index) {
            const form = document.getElementById('edit-form');
            const updatedRecord = {};
            const fields = formsConfig[formId].fields.flatMap(f => f.type === 'section' ? f.fields : [f]);
            fields.forEach(field => {
                updatedRecord[field.id] = form.elements[field.id].value;
            });

            appState.data[formId][index] = updatedRecord;
            localStorage.setItem('diaryAppData', JSON.stringify(appState.data));
            renderForm(formId);
            translateUI();
            editModal.classList.add('hidden');
        }

        function filterTable(formId, query) {
            const filteredData = (appState.data[formId] || []).filter(row =>
                Object.values(row).some(value => String(value).toLowerCase().includes(query.toLowerCase()))
            );
            const tableBody = document.getElementById(`${formId}-table-body`);
            tableBody.innerHTML = filteredData.length > 0
                ? filteredData.map(row => generateTableRowHTML(row, formId, appState.data[formId].indexOf(row))).join('')
                : `<tr><td colspan="${formsConfig[formId].fields.flatMap(f => f.type === 'section' ? f.fields : [f]).length + 1}" class="p-4 text-center text-slate-500" data-translate-key="noRecords">${translate('noRecords')}</td></tr>`;
        }

        function switchForm(targetFormId) {
            appState.currentForm = targetFormId;
            document.querySelectorAll('.form-container').forEach(c => c.classList.add('hidden'));
            document.getElementById(`form-${targetFormId}`).classList.remove('hidden');

            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            document.querySelector(`.nav-link[data-form="${targetFormId}"]`).classList.add('active');

            if (!document.getElementById(`${targetFormId}-form`)) {
                renderForm(targetFormId);
            }
            translateUI(); // This will also update the header
        }

        function setupEventListeners() {
            menuToggle.addEventListener('click', () => {
                sidebar.classList.toggle('sidebar-closed');
                sidebar.classList.toggle('sidebar-open');
            });

            document.querySelectorAll('.nav-link[data-form]').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    switchForm(link.dataset.form);
                    if (window.innerWidth < 768) {
                        sidebar.classList.add('sidebar-closed');
                        sidebar.classList.remove('sidebar-open');
                    }
                });
            });

            document.getElementById('language-selector').addEventListener('change', (e) => {
                appState.currentLanguage = e.target.value;
                // Re-render the current form to update all dynamic text like table headers
                renderForm(appState.currentForm);
                translateUI();
            });
        }

        function init() {
            loadData();
            const langSelector = document.getElementById('language-selector');
            allLanguages.forEach(lang => {
                const option = document.createElement('option');
                option.value = lang.code;
                option.textContent = lang.name;
                langSelector.appendChild(option);
            });
            langSelector.value = appState.currentLanguage;

            Object.keys(formsConfig).forEach(formId => {
                renderForm(formId);
            });

            setupEventListeners();
            switchForm(appState.currentForm); // Initial form load
        }

        // --- INITIALIZE APP ---
        document.addEventListener('DOMContentLoaded', init);
    </script>
   

</body>


</html>



